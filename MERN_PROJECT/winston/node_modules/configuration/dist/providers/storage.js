"use strict";
/* IMPORT */
Object.defineProperty(exports, "__esModule", { value: true });
const path_prop_1 = require("path-prop");
const config_1 = require("../config");
const memory_1 = require("./memory");
/* STORAGE */
class ProviderStorage extends memory_1.default {
    constructor(options) {
        var _a;
        super(options);
        if (!options.storage)
            throw new Error('You need to pass a storage instance');
        this.id = (_a = options === null || options === void 0 ? void 0 : options.id) !== null && _a !== void 0 ? _a : config_1.DEFAULTS.id;
        this.storage = options.storage;
        this.init();
    }
    readSync() {
        var _a, _b;
        if (!this.storage)
            return super.readSync();
        const dataRaw = (_a = this.storage.getItem(this.id)) !== null && _a !== void 0 ? _a : this.defaultsRaw, data = path_prop_1.default.unflat((_b = this.dataParser.parse(dataRaw)) !== null && _b !== void 0 ? _b : this.defaults);
        return { data, dataRaw };
    }
    writeSync(data, force = false) {
        if (!this.storage)
            return super.writeSync(data, force);
        if (!force && this.isEqual(data))
            return;
        super.writeSync(data, true);
        try {
            this.storage.setItem(this.id, this.dataRaw);
        }
        catch (_a) { }
    }
}
/* EXPORT */
exports.default = ProviderStorage;
