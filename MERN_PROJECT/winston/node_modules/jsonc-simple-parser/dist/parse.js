"use strict";
/* IMPORT */
Object.defineProperty(exports, "__esModule", { value: true });
const strip_1 = require("./strip");
/* HELPERS */
const _parse = JSON.parse;
/* PARSE */
const parse = (text, reviver) => {
    text = `${text}`; // "text" can actually be anything, but we need a string here
    if (reviver) { // A "reviver" could have side effects, it may not be safe to call it twice
        return _parse((0, strip_1.default)(text), reviver);
    }
    else {
        try { // Shortcut in case there are no comments or trailing commas
            return _parse(text);
        }
        catch (error) { // Stripping out any potential comments and trailing commas and trying again
            const textStripped = (0, strip_1.default)(text);
            if (text === textStripped) { // Parsing it again would inevitably lead to the same error
                throw error;
            }
            else {
                return _parse(textStripped);
            }
        }
    }
};
/* EXPORT */
exports.default = parse;
