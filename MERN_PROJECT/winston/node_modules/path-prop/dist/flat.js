"use strict";
/* IMPORT */
Object.defineProperty(exports, "__esModule", { value: true });
var constants_1 = require("./constants");
var utils_1 = require("./utils");
/* MAIN */
var flatArray = function (arr) {
    var length = arr.length;
    var flattened = new Array(length);
    for (var i = 0; i < length; i++) {
        var value = arr[i];
        if (typeof value !== 'object' || value === null) {
            flattened[i] = value;
        }
        else {
            flattened[i] = flat(value);
        }
    }
    return flattened;
};
var flatObject = function (object, prefix) {
    if (prefix === void 0) { prefix = ''; }
    var flattened = {};
    for (var key in object) {
        if (key === 'constructor' || key === 'prototype' || key === '__proto__')
            break;
        var value = object[key];
        if (value === undefined)
            continue;
        if (typeof value !== 'object' || value === null) {
            flattened["" + prefix + key] = value;
        }
        else if (utils_1.isArray(value)) {
            flattened["" + prefix + key] = flatArray(value);
        }
        else if (utils_1.isEmpty(value)) {
            flattened["" + prefix + key] = {};
        }
        else {
            var flattenedDeep = flatObject(value, "" + prefix + key + constants_1.DIVIDER);
            for (var key_1 in flattenedDeep) {
                flattened[key_1] = flattenedDeep[key_1];
            }
        }
    }
    return flattened;
};
var flat = function (object, prefix) {
    if (prefix === void 0) { prefix = ''; }
    if (utils_1.isArray(object))
        return flatArray(object);
    return flatObject(object, prefix);
};
/* EXPORT */
exports.default = flat;
