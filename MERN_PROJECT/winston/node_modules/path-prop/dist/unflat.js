"use strict";
/* IMPORT */
Object.defineProperty(exports, "__esModule", { value: true });
var get_1 = require("./get");
var set_1 = require("./set");
var utils_1 = require("./utils");
/* MAIN */
var unflatArray = function (arr) {
    var length = arr.length;
    var unflattened = new Array(length);
    for (var i = 0; i < length; i++) {
        var value = arr[i];
        if (typeof value !== 'object' || value === null) {
            unflattened[i] = value;
        }
        else {
            unflattened[i] = unflat(value);
        }
    }
    return unflattened;
};
var unflatObject = function (object) {
    var unflattened = {};
    for (var key in object) {
        if (key === 'constructor' || key === 'prototype' || key === '__proto__')
            break;
        var value = object[key];
        if (value === undefined)
            continue;
        if (typeof value !== 'object' || value === null) {
            set_1.default(unflattened, key, value);
        }
        else {
            var valuePrev = get_1.default(unflattened, key);
            if (typeof valuePrev !== 'object' || valuePrev === null) {
                set_1.default(unflattened, key, unflat(value));
            }
            else {
                set_1.default(unflattened, key, utils_1.merge([valuePrev, unflat(value)]));
            }
        }
    }
    return unflattened;
};
var unflat = function (object) {
    if (utils_1.isArray(object))
        return unflatArray(object);
    return unflatObject(object);
};
/* EXPORT */
exports.default = unflat;
